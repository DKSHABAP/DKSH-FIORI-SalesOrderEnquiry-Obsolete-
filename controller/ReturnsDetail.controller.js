sap.ui.define(["sap/ui/core/mvc/Controller","../model/formatter","sap/m/MessageBox","sap/m/MessageToast"],function(e,t,a,r){"use strict";return e.extend("incture.com.cherrywork.ConnectClientSalesOrderEnquiry.controller.ReturnsDetail",{formatter:t,onInit:function(){this.oRouter=this.getOwnerComponent().getRouter();sap.ui.core.UIComponent.getRouterFor(this).attachRoutePatternMatched(this.onRouteMatched,this)},onRouteMatched:function(e){var t=sap.ui.getCore().getModel("oGlobalModel");if(e.getParameter("arguments").index){this.selectedObjects=[];var a=e.getParameter("arguments").index;var r=new sap.ui.model.json.JSONModel;this.getView().setModel(r,"oTableModel");r.setProperty("/data",t.getData().results[a]);var i=new sap.ui.model.json.JSONModel;this.getView().setModel(i,"oDocFlowModel");if(r.getData().data.HeaderToItemNav.results.length>0){var o=r.getData().data.HeaderToItemNav.results;var s=[];var n={};for(d in o){var l=o[d]["deliveryNum"];n[l]=o[d]}for(d in n){s.push(n[d])}for(var u=0;u<s.length;u++){if(!s[u].deliveryNum)s.splice(u,1)}i.getData().results=s;i.refresh()}var g=new sap.ui.model.json.JSONModel;this.getView().setModel(g,"oitemsModel");g.getData().results=r.getData().data.HeaderToItemNav.results;for(var d=0;d<g.getData().results.length;d++){if(g.getData().results[d].b2bStatus)g.getData().results[d].b2bstatus=g.getData().results[d].b2bStatus.split("@")}g.refresh();var P=new sap.ui.model.json.JSONModel;this.getView().setModel(P,"oBMModel");P.getData().array=r.getData().data.HeaderToPartnersNav.results;P.refresh();this.getUserDetails()}},getUserDetails:function(){var e=this;$.ajax({type:"GET",async:false,url:"/services/userapi/currentUser",contentType:"application/scim+json",success:function(t,a,r){var i=new sap.ui.model.json.JSONModel(t);e.getView().setModel(i,"userapi");var o=new sap.ui.model.json.JSONModel;e.getView().setModel(o,"PersonalizationModel");e._getPersonalizationDetails()},error:function(t){sap.m.MessageBox.error(e.getView().getModel("i18n").getProperty("retrieveDetails"))}})},personalizationInvDetails:function(e){if(!this.FilterPersonalization){this.FilterPersonalization=sap.ui.xmlfragment("incture.com.cherrywork.ConnectClientSalesOrderEnquiry.fragments.Personalization",this);this.getView().addDependent(this.FilterPersonalization)}this._getPersonalizationDetails();this.FilterPersonalization.open()},_getPersonalizationDetails:function(){var e=this;var t=new sap.ui.model.json.JSONModel;e.getView().setModel(t,"oModel");var r="Web";var i={"Content-Type":"application/json;charset=utf-8"};var o={userId:this.getView().getModel("userapi").getProperty("/name"),appId:"keySoEnquiry",runType:r,emailId:this.getView().getModel("userapi").getData().email};t.loadData("/DKSHJavaService/variant/getVariant",JSON.stringify(o),true,"POST",false,false,i);t.attachRequestCompleted(function(t){if(t.getSource().getData().userPersonaDto!==null){e.getView().getModel("PersonalizationModel").setProperty("/personalizationInvoiceData",t.getSource().getData());var a=new sap.ui.model.json.JSONModel({});a.setData({enableCheckBox:false,selectVarVisible:true,nameVarVisible:false,okPersBtnVisible:true,savePersBtnVisible:false,cancelPersBtnVisible:true,deletePersBtnVisible:false,createPersBtnVisible:true,varinatNameValueState:"None",editPersBtnVisible:true,results:t.getSource().getData()});if(e.FilterPersonalization){e.FilterPersonalization.setModel(a,"FilterPersonalization");e.FilterPersonalization.getModel("FilterPersonalization").refresh();e.FilterPersonalization.getModel("FilterPersonalization").setProperty("/results/action","")}}});t.attachRequestFailed(function(e){a.error(e.getSource().getData().message)})},onVariantOK:function(){this.FilterPersonalization.close()},onPersonlizationClose:function(){this.selectedObjects=[];this.FilterPersonalization.close()},onVariantCreate:function(){var e=this.FilterPersonalization.getModel("FilterPersonalization");e.setProperty("/results/action","Create");e.setProperty("/selectVarVisible",false);e.setProperty("/nameVarVisible",true);e.setProperty("/enableCheckBox",true);e.setProperty("/okPersBtnVisible",false);e.setProperty("/savePersBtnVisible",true);e.setProperty("/newVariantName","");var t=e.getData().results.userPersonaDto;for(var a=0;a<t.length;a++){t[a].status=false}e.setProperty("/results/userPersonaDto",t);this.FilterPersonalization.getModel("FilterPersonalization").refresh()},onVariantSave:function(e){if(this.selectedObjects.length===0){r.show(this.getView().getModel("i18n").getProperty("saveAfterEdit"));return}var t=this;var i=new sap.ui.model.json.JSONModel;var o=this.FilterPersonalization.getModel("FilterPersonalization");if(o.getProperty("/results/action")==="Create"){if(o.getData().newVariantName!==undefined&&o.getData().newVariantName!==""){for(var s=0;s<o.getData().results.variantName.length;s++){if(o.getData().results.variantName[s].name===o.getData().newVariantName){this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/varinatNameValueState","Error");a.error(this.getView().getModel("i18n").getProperty("newVariant"));return}}this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/varinatNameValueState","None");var n=o.getData().newVariantName;for(var l=0;l<this.selectedObjects.length;l++){this.selectedObjects[l].variantId=n}}else{this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/varinatNameValueState","Error");sap.m.MessageBox.error(this.getView().getModel("i18n").getProperty("enterVariant"));return}}var u={varaiantObject:this.selectedObjects,userId:this.getView().getModel("userapi").getProperty("/name"),applicationId:"keySoEnquiry",varaintId:this.selectedObjects[0].variantId};var g={"Content-Type":"application/json;charset=utf-8"};var d=new sap.m.BusyDialog;d.open();i.loadData("/DKSHJavaService/variant/UpdateVariant",JSON.stringify(u),true,"PUT",false,false,g);i.attachRequestCompleted(function(e){d.close();t.selectedObjects=[];t.FilterPersonalization.close();sap.m.MessageBox.success(t.getView().getModel("i18n").getProperty("created"),{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){if(e===a.Action.OK){t._getPersonalizationDetails(t.currentStep,"Before")}}})});i.attachRequestFailed(function(e){a.error(e.getSource().getData().message)})},onChangeCheckbox:function(e){var t=this.FilterPersonalization.getModel("FilterPersonalization").getData().results.userPersonaDto;var a=parseInt(e.getSource().getBindingContext("FilterPersonalization").getPath().split("/")[3]);if(e.getSource().getSelected()===true){for(var r=0;r<t.length;r++){if(r===a){t[r].status=true}if(this.FilterPersonalization.getModel("FilterPersonalization").getProperty("/results/action")==="Create"){t[r].id=""}this.selectedObjects=t}}else{for(var i=0;i<t.length;i++){if(i===a){t[i].status=false}}this.selectedObjects=t}},onSelectvarian:function(e){var t=this;var i=this.getView().getModel("userapi").getProperty("/name");var o=new sap.ui.model.json.JSONModel;t.getView().setModel(o,"oModel");if(e){var s=e.getSource().getSelectedKey()}else{var s=this.FilterPersonalization.getModel("FilterPersonalization").getData().results.currentVariant}var n={"Content-Type":"application/json;charset=utf-8"};var l="Web";var u=new sap.m.BusyDialog;u.open();o.loadData("/DKSHJavaService/variant/getvariantLists/"+i+"/keySoEnquiry/"+s+"/"+l,true,"POST",false,false,n);o.attachRequestCompleted(function(e){u.close();var e=e.getSource().getData().userPersonaDto;if(t.FilterPersonalization.getModel("FilterPersonalization").getProperty("/results/action")==="Edit"){t.getView().getModel("PersonalizationModel").setProperty("/personalizationInvoiceData/userPersonaDto",e);t.FilterPersonalization.getModel("FilterPersonalization").setProperty("/results/userPersonaDto",e);t.FilterPersonalization.getModel("FilterPersonalization").refresh();t.getView().getModel("PersonalizationModel").refresh();if(t.FilterPersonalization.getModel("FilterPersonalization").getProperty("/results/currentVariant")==="Default"){t.FilterPersonalization.getModel("FilterPersonalization").setProperty("/results/action","");t.FilterPersonalization.getModel("FilterPersonalization").setProperty("/enableCheckBox",false);t.FilterPersonalization.getModel("FilterPersonalization").setProperty("/savePersBtnVisible",false);t.FilterPersonalization.getModel("FilterPersonalization").setProperty("/okPersBtnVisible",true);t.FilterPersonalization.getModel("FilterPersonalization").setProperty("/deletePersBtnVisible",false);t.FilterPersonalization.getModel("FilterPersonalization").setProperty("/selectVarVisible",true);t.FilterPersonalization.getModel("FilterPersonalization").setProperty("/nameVarVisible",false);r.show(t.getView().getModel("i18n").getProperty("cannotEdit"));t.FilterPersonalization.getModel("FilterPersonalization").refresh()}}else{t.getView().getModel("PersonalizationModel").setProperty("/personalizationInvoiceData/userPersonaDto",e);t.FilterPersonalization.getModel("FilterPersonalization").setProperty("/results/userPersonaDto",e);t.FilterPersonalization.getModel("FilterPersonalization").refresh();t.getView().getModel("PersonalizationModel").refresh()}});o.attachRequestFailed(function(e){a.error(e.getSource().getData().message)})},onVariantEdit:function(){var e=this.FilterPersonalization.getModel("FilterPersonalization");if(e.getData().results.currentVariant==="Default"){r.show(this.getView().getModel("i18n").getProperty("cannotEdit"));return}e.setProperty("/results/action","Edit");this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/okPersBtnVisible",false);e.setProperty("/enableCheckBox",true);e.setProperty("/savePersBtnVisible",true);e.setProperty("/deletePersBtnVisible",true);e.setProperty("/selectVarVisible",true);e.setProperty("/nameVarVisible",false);e.refresh();this.onSelectvarian()},onVariantDelete:function(){var e=this;var t=this.FilterPersonalization.getModel("FilterPersonalization").getProperty("/results/userPersonaDto");var r={userId:this.getView().getModel("userapi").getProperty("/name"),applicationId:"keySoEnquiry",varaiantObject:t,varaintId:this.FilterPersonalization.getModel("FilterPersonalization").getProperty("/results/userPersonaDto")[0].variantId};var i={"Content-Type":"application/json;charset=utf-8"};var o=new sap.ui.model.json.JSONModel;var s=new sap.m.BusyDialog;s.open();o.loadData("/DKSHJavaService/variant/deleteVariant",JSON.stringify(r),true,"DELETE",false,false,i);o.attachRequestCompleted(function(t){s.close();e.FilterPersonalization.close();sap.m.MessageBox.success(t.getSource().getData().name,{actions:[sap.m.MessageBox.Action.OK],onClose:function(t){if(t===a.Action.OK){e._getPersonalizationDetails()}}})});o.attachRequestFailed(function(e){a.error(e.getSource().getData().name)})}})});