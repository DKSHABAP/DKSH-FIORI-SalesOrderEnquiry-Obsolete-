sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","../model/formatter","sap/ui/export/Spreadsheet"],function(e,t,r,a,s,i){"use strict";return e.extend("incture.com.cherrywork.ConnectClientSalesOrderEnquiry.controller.ReturnsView",{formatter:s,onInit:function(){this.oRouter=this.getOwnerComponent().getRouter();sap.ui.core.UIComponent.getRouterFor(this).attachRoutePatternMatched(this._onRouteMatched,this);var e=new sap.ui.model.json.JSONModel;this.getView().setModel(e,"baseModel");this.getView().getModel("baseModel").setProperty("/openVisiblity",false);this.getView().getModel("baseModel").setProperty("/CollapseVisiblity",true);this.getView().getModel("baseModel").setProperty("/SearchVisiblity",true);this.salesHdrData={customerPo:"",SoldtoParty:"",SoldtoPartyDesc:"",DistChan:"",DistChanDesc:"",salesOrg:"",division:"",CustomerNo:"",shipToParty:"",headerDlvBlock:"",Reason:"",Description:"",orderNumber:"",materialGroup:"",materialGroupDesc:"",materialGroup4:"",materialGroup4Desc:"",poType:"",poTypeDesc:"",billingNumber:"",DMSNumber:"",startDate:new Date,endDate:new Date,loginInUserId:this.userID};this.SalesHdrModel=new sap.ui.model.json.JSONModel(this.salesHdrData);this.getView().setModel(this.SalesHdrModel,"SaleHdrModelSet");this.allAccess=true;this.getLoggedInUserDetail()},_onRouteMatched:function(){},getLoggedInUserDetail:function(){var e;var t=this;$.ajax({type:"GET",async:false,url:"/services/userapi/currentUser",contentType:"application/scim+json",success:function(r,a,s){var i=new sap.ui.model.json.JSONModel(r);t.getView().setModel(i,"userapi");e=t.getView().getModel("userapi").getData().name;t.userID=e;t.getLoggedInUserName(e);t.getAttributeDetails(e)},error:function(e){sap.m.MessageBox.error(t.getView().getModel("i18n").getProperty("retrieveDetails"))},complete:function(e){}});return e},getAttributeDetails:function(e){var t=this;$.ajax({type:"GET",async:false,url:"/DKSHJavaService/userDetails/findAllRightsForUserInDomain/"+e+"&cc",contentType:"application/scim+json",success:function(e,r,a){if(e.message)t.allAccess=false;t.salesOrgDataAccess=e.ATR01;t.distrChannelDataAccess=e.ATR02;t.divisionDataAccess=e.ATR03;t.materialGroupDataAccess=e.ATR04;t.materialGroup4DataAccess=e.ATR05;t.custCodeDataAccess=e.ATR06;t.MaterialCodeDac=e.ATR07;t.orderTypeDataAccess=e.ATR08},error:function(e){t.salesOrgDataAccess=null;t.distrChannelDataAccess=null;t.divisionDataAccess=null;t.materialGroupDataAccess=null;t.materialGroup4DataAccess=null;t.custCodeDataAccess=null;t.MaterialCodeDac=null;t.orderTypeDataAccess=null;if(e.status==409)t.allAccess=false;else sap.m.MessageBox.error(thes.getView().getModel("i18n").getProperty("retrieveDetails"))},complete:function(e){}})},getLoggedInUserName:function(e){var t=this;var r=new sap.ui.model.json.JSONModel;t.getView().setModel(r,"oLoggedInUserDetailModel");r.loadData("/IDPService/service/scim/Users/"+e,null,true);r.attachRequestCompleted(function(e){var r=e.getSource().getData().id;t.getView().getModel("oLoggedInUserDetailModel").setProperty("/userLoginId",r);var a=e.getSource().getData().name;t.getView().getModel("oLoggedInUserDetailModel").setProperty("/loggedInUser",a.givenName+" "+a.familyName);var s=e.getSource().getData().emails["0"].value;t.getView().getModel("oLoggedInUserDetailModel").setProperty("/loggedInUserMail",s)});r.attachRequestFailed(function(e){a.error(e.getSource().getData().message)})},onNavigateToDetail:function(e){var t=e.getSource().getBindingContext("oTableModel").getObject().index;this.oRouter.navTo("ReturnsDetail",{index:t})},onClear:function(){this.salesHdrData={DistChan:"",DistChanDesc:"",salesOrg:"",division:"",CustomerNo:"",shipToParty:"",headerDlvBlock:"",Reason:"",Description:"",orderNumber:"",materialGroup:"",materialGroupDesc:"",materialGroup4:"",materialGroup4Desc:"",billingNumber:"",DMSNumber:""};this.getView().getModel("SaleHdrModelSet").setData(this.salesHdrData);this.getView().getModel("SaleHdrModelSet").refresh(true);var e=this.getView().getModel("oTableModel");this.getView().byId("searchField").setValue("");if(e){e.setData();e.refresh()}},valueHelpRequestSalesOrg:function(e){this.salesOrgInputId=e.getSource().getId();var t=this;if(!t.salesOrgDataAccess){r.show(this.getView().getModel("i18n").getProperty("DataAccessControl"))}else{if(!t.SalesOrgFrag){t.SalesOrgFrag=sap.ui.xmlfragment("incture.com.cherrywork.ConnectClientSalesOrderEnquiry.fragments.SalesOrg",t);t.getView().addDependent(t.SalesOrgFrag);var a=this.getView().getModel("ODataNewService");var s="";s="EN";s=s.toUpperCase();var i=[];var o=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Language",sap.ui.model.FilterOperator.EQ,s),new sap.ui.model.Filter("SalesOrg",sap.ui.model.FilterOperator.EQ,t.salesOrgDataAccess)],and:true});i.push(o);var l=new sap.m.BusyDialog;l.open();a.read("/ZSALESORGLOOKUPSet",{async:true,filters:i,success:function(e,r){l.close();var a=new sap.ui.model.json.JSONModel({results:e.results});a.getData().results.unshift("");a.setSizeLimit(e.results.length);t.SalesOrgFrag.setModel(a,"SalesOrgSet");t.SalesOrgFrag.open()},error:function(e){l.close();var r="";if(e.statusCode===504){r=t.getView().getModel("i18n").getProperty("timeout");t.errorMsg(r)}else{r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r)}}})}else{t.SalesOrgFrag.open()}}},handleAddSalesOrg:function(e){var t=e.getParameters().selectedContexts[0].getObject();if(this.salesOrgInputId==="idFrgQty"){var r=this.getView().getModel("SoldToPartyModSet");r.getData().SalesOrg=t.SalesOrg;r.getData().SalesOrgDesc=t.Name;r.refresh()}else{var a=this.getView().getModel("SaleHdrModelSet");a.getData().salesOrg=t.SalesOrg;a.getData().SalesOrgDesc=t.Name;a.refresh()}e.getSource().getBinding("items").filter([])},handleCancelSalesOrg:function(e){e.getSource().getBinding("items").filter([])},onLiveChangeSalesOrg:function(e){var t=e.getParameters().value;var r=new Array;var a=new sap.ui.model.Filter([new sap.ui.model.Filter("SalesOrg",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Name",sap.ui.model.FilterOperator.Contains,t)]);r.push(a);var s=e.getSource().getBinding("items");s.filter(r)},valueHelpRequestDistChan:function(e){var t=this;this.distChnlInputId=e.getSource().getId();if(!t.distrChannelDataAccess){r.show(this.getView().getModel("i18n").getProperty("DataAccessControl"))}else{if(!t.DistChanFrag){t.DistChanFrag=sap.ui.xmlfragment("incture.com.cherrywork.ConnectClientSalesOrderEnquiry.fragments.DistributionChannel",t);t.getView().addDependent(t.DistChanFrag);var a=this.getView().getModel("ODataNewService");var s=[];var i="";i="EN";i=i.toUpperCase();var o=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Language",sap.ui.model.FilterOperator.EQ,i),new sap.ui.model.Filter("DistChl",sap.ui.model.FilterOperator.EQ,t.distrChannelDataAccess)],and:true});s.push(o);var l=new sap.m.BusyDialog;l.open();a.read("/ZDISTCHLLOOKUPSet",{async:false,filters:s,success:function(e,r){l.close();var a=new sap.ui.model.json.JSONModel({results:e.results});a.getData().results.unshift("");a.setSizeLimit(e.results.length);t.DistChanFrag.setModel(a,"DistChanSet");t.DistChanFrag.open()},error:function(e){l.close();var r="";if(e.statusCode===504){r=t.getView().getModel("i18n").getProperty("timeout");t.errorMsg(r)}else{r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r)}}})}else{t.DistChanFrag.open()}}},handleAddDistChan:function(e){var t=e.getParameters().selectedContexts[0].getObject();if(this.distChnlInputId==="idDistChanCC"){var r=this.getView().getModel("SoldToPartyModSet");r.getData().DistChan=t.DistChl;r.getData().DistChanDesc=t.Name;r.refresh()}else{var a=this.getView().getModel("SaleHdrModelSet");a.getData().DistChan=t.DistChl;a.getData().DistChanDesc=t.Name;a.refresh()}e.getSource().getBinding("items").filter([])},handleCancelDistChan:function(e){e.getSource().getBinding("items").filter([])},valueHelpRequestDivision:function(e){this.divisionInputId=e.getSource().getId();var t=this;if(!t.divisionDataAccess){r.show(this.getView().getModel("i18n").getProperty("DataAccessControl"))}else{if(!t.DivisionFrag){t.DivisionFrag=sap.ui.xmlfragment("incture.com.cherrywork.ConnectClientSalesOrderEnquiry.fragments.Division",t);t.getView().addDependent(t.DivisionFrag);var a=this.getView().getModel("ODataNewService");var s=[];var i="";i="EN";i=i.toUpperCase();var o=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Language",sap.ui.model.FilterOperator.EQ,i),new sap.ui.model.Filter("Division",sap.ui.model.FilterOperator.EQ,t.divisionDataAccess)],and:true});s.push(o);var l=new sap.m.BusyDialog;l.open();a.read("/ZDIVISIONLOOKUPSet",{async:false,filters:s,success:function(e,r){l.close();var a=new sap.ui.model.json.JSONModel({results:e.results});a.getData().results.unshift("");a.setSizeLimit(e.results.length);t.DivisionFrag.setModel(a,"DivisionSet");t.DivisionFrag.open()},error:function(e){l.close();var r="";if(e.statusCode===504){r=t.getView().getModel("i18n").getProperty("timeout");t.errorMsg(r)}else{r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r)}}})}else{t.DivisionFrag.open()}}},handleAddDivision:function(e){var t=e.getParameters().selectedContexts[0].getObject();if(this.divisionInputId==="idFrgPrice"){var r=this.getView().getModel("SoldToPartyModSet");r.getData().Division=t.Division;r.getData().DivisionDesc=t.Name;r.refresh()}else{var a=this.getView().getModel("SaleHdrModelSet");a.getData().division=t.Division;a.getData().DivisionDesc=t.Name;a.refresh()}e.getSource().getBinding("items").filter([])},handleCancelDivision:function(e){e.getSource().getBinding("items").filter([])},onLiveChangeDivision:function(e){var t=e.getParameters().value;var r=new Array;var a=new sap.ui.model.Filter([new sap.ui.model.Filter("Division",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Name",sap.ui.model.FilterOperator.Contains,t)]);r.push(a);var s=e.getSource().getBinding("items");s.filter(r)},onLiveChangeDistChan:function(e){var t=e.getParameters().value;var r=new Array;var a=new sap.ui.model.Filter([new sap.ui.model.Filter("DistChl",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Name",sap.ui.model.FilterOperator.Contains,t)]);r.push(a);var s=e.getSource().getBinding("items");s.filter(r)},handleVHOType:function(e){var t=this;if(!t.orderTypeDataAccess){r.show(this.getView().getModel("i18n").getProperty("DataAccessControl"))}else{if(!t.orderType){t.orderType=sap.ui.xmlfragment("incture.com.cherrywork.ConnectClientSalesOrderEnquiry.fragments.orderType",t);t.getView().addDependent(t.orderType);var a=this.getView().getModel("ZDKSH_CC_DAC_LOOKUP_SRV");var s=new sap.m.BusyDialog;s.open();var i=[];var o="";o="EN";o=o.toUpperCase();var l=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("orderType",sap.ui.model.FilterOperator.EQ,t.orderTypeDataAccess)]});i.push(l);a.read("/orderTypeLookupSet",{async:true,filters:i,success:function(e,r){s.close();var a=new sap.ui.model.json.JSONModel({results:e.results});a.getData().results.unshift("");a.setSizeLimit(e.results.length);t.orderType.setModel(a,"orderTypeModel");t.orderType.open()},error:function(e){s.close();var r="";if(e.statusCode===504){r=t.getView().getModel("i18n").getProperty("timeout");t.errorMsg(r)}else{r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r)}}})}else{t.orderType.open()}}},handleVHDB:function(e){var t=this;if(!t.headerBlock){t.headerBlock=sap.ui.xmlfragment("incture.com.cherrywork.ConnectClientSalesOrderEnquiry.fragments.HeaderBlock",t);t.getView().addDependent(t.headerBlock);var r=this.getView().getModel("ZDKSH_CC_DAC_LOOKUP_SRV");r.read("/headerDlvBlockLookUpSet",{async:true,success:function(e,r){var a=new sap.ui.model.json.JSONModel({results:e.results});a.getData().results.unshift("");t.headerBlock.setModel(a,"headerBlockModel");t.headerBlock.open()},error:function(e){var r="";if(e.statusCode===504){r=t.getView().getModel("i18n").getProperty("timeout");t.errorMsg(r)}else{r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r)}}})}else{t.headerBlock.open()}},handleAddOt:function(e){var t=e.getParameters().selectedContexts[0].getObject();var r=this.getView().getModel("SaleHdrModelSet");r.getData().orderType=t.orderType;r.getData().orderTypeDesc=t.orderTypeDesc;r.refresh();e.getSource().getBinding("items").filter([])},handleCancelOt:function(e){e.getSource().getBinding("items").filter([])},onLiveOt:function(e){var t=e.getParameters().value;var r=new Array;var a=new sap.ui.model.Filter([new sap.ui.model.Filter("orderType",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("orderTypeDesc",sap.ui.model.FilterOperator.Contains,t)]);r.push(a);var s=e.getSource().getBinding("items");s.filter(r)},handleAddHB:function(e){var t=e.getParameters().selectedContexts[0].getObject();var r=this.getView().getModel("SaleHdrModelSet");r.getData().deliveryBlock=t.deliveryBlock;r.getData().delBlockDesc=t.delBlockDesc;r.refresh();e.getSource().getBinding("items").filter([])},handlePO:function(e){var t=this;if(!t.purchaseOrder){t.purchaseOrder=sap.ui.xmlfragment("incture.com.cherrywork.ConnectClientSalesOrderEnquiry.fragments.purchaseOrder",t);t.getView().addDependent(t.headerBlock);var r=this.getView().getModel("ZDKSH_CC_MASTER_ENQUIRIES_SRV");var a=[];var s="";if(sap.ushell){if(sap.ui.getCore().getConfiguration().getLanguage()==="th"){s="2"}else{s="E"}}else{s="E"}s=s.toUpperCase();var i=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("languageID",sap.ui.model.FilterOperator.EQ,s)],and:true});a.push(i);r.read("/purchaseOrderTypeLookUpSet",{async:true,filters:a,success:function(e,r){var a=new sap.ui.model.json.JSONModel({results:e.results});a.getData().results.unshift("");a.setSizeLimit(e.results.length);t.purchaseOrder.setModel(a,"purchaseOrderModel");t.purchaseOrder.open()},error:function(e){var r="";if(e.statusCode===504){r=t.getView().getModel("i18n").getProperty("timeout");t.errorMsg(r)}else{r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r)}}})}else{t.purchaseOrder.open()}},handleAddPO:function(e){var t=e.getParameters().selectedContexts[0].getObject();var r=this.getView().getModel("SaleHdrModelSet");r.getData().poType=t.purchaseOrderType;r.getData().poTypeDesc=t.poTypeDesc;r.refresh();e.getSource().getBinding("items").filter([])},handleCancelPO:function(e){e.getSource().getBinding("items").filter([])},onLivePO:function(e){var t=e.getParameters().value;var r=new Array;var a=new sap.ui.model.Filter([new sap.ui.model.Filter("purchaseOrderType",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("poTypeDesc",sap.ui.model.FilterOperator.Contains,t)]);r.push(a);var s=e.getSource().getBinding("items");s.filter(r)},handleCancelHB:function(e){e.getSource().getBinding("items").filter([])},onLiveHB:function(e){var t=e.getParameters().value;var r=new Array;var a=new sap.ui.model.Filter([new sap.ui.model.Filter("deliveryBlock",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("delBlockDesc",sap.ui.model.FilterOperator.Contains,t)]);r.push(a);var s=e.getSource().getBinding("items");s.filter(r)},errorMsg:function(e){sap.m.MessageBox.show(e,{styleClass:"sapUiSizeCompact",icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})},valueHelpRequestMaterialGrp4:function(e){this.matGrp4Placeholder=e.getSource().getPlaceholder();var t=this;if(!t.materialGroup4DataAccess){r.show(this.getView().getModel("i18n").getProperty("DataAccessControl"))}else{if(!t.materialGroup4){t.materialGroup4=sap.ui.xmlfragment("incture.com.cherrywork.ConnectClientSalesOrderEnquiry.fragments.MaterialGroup4",t);t.getView().addDependent(t.materialGroup4);var a=this.getView().getModel("ZDKSH_CC_INVENTORY_HDRLOOKUP_SRV");var s=[];var i="";if(sap.ushell){if(sap.ui.getCore().getConfiguration().getLanguage()==="th"){i="2"}else{i="EN"}}else{i="EN"}i=i.toUpperCase();var o=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("language",sap.ui.model.FilterOperator.EQ,i),new sap.ui.model.Filter("materialGroup4",sap.ui.model.FilterOperator.EQ,t.materialGroup4DataAccess)],and:true});s.push(o);var l=new sap.m.BusyDialog;l.open();a.read("/ZSearchHelp_MaterialGroup4Set",{async:false,filters:s,success:function(e,r){l.close();var a=new sap.ui.model.json.JSONModel({results:e.results});t.materialGroup4.setModel(a,"materialGrp4Model");t.materialGroup4.open()},error:function(e){l.close();var r="";if(e.statusCode===504){r=t.getView().getModel("i18n").getProperty("timeout");t.errorMsg(r)}else{r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r)}}})}else{t.materialGroup4.open()}}},onConfirmChangeMatGrp:function(e){var t=e.getParameters().selectedContexts[0].getObject();var r=this.getView().getModel("SaleHdrModelSet");r.getData().materialGroup=t.materialGroup;r.getData().materialGroupDesc=t.materialGroupDesc;r.refresh();e.getSource().getBinding("items").filter([])},valueHelpRequestMaterialGrp:function(e){this.matGrpPlaceholder=e.getSource().getPlaceholder();var t=this;if(!t.materialGroupDataAccess){r.show(this.getView().getModel("i18n").getProperty("DataAccessControl"))}else{if(!t.MaterialGroup){t.MaterialGroup=sap.ui.xmlfragment("incture.com.cherrywork.ConnectClientSalesOrderEnquiry.fragments.MaterialGroup",t);t.getView().addDependent(t.MaterialGroup);var a=this.getView().getModel("ZDKSH_CC_INVENTORY_HDRLOOKUP_SRV");var s=[];var i="";var i="";if(sap.ushell){if(sap.ui.getCore().getConfiguration().getLanguage()==="th"){i="2"}else{i="EN"}}else{i="EN"}i=i.toUpperCase();var o=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("language",sap.ui.model.FilterOperator.EQ,i),new sap.ui.model.Filter("materialGroup",sap.ui.model.FilterOperator.EQ,t.materialGroupDataAccess)],and:true});s.push(o);var l=new sap.m.BusyDialog;l.open();a.read("/ZSearchHelp_MaterialGroupSet",{async:false,filters:s,success:function(e,r){l.close();var a=new sap.ui.model.json.JSONModel({results:e.results});t.MaterialGroup.setModel(a,"MaterialGroupModel");t.MaterialGroup.open()},error:function(e){l.close();var r="";if(e.statusCode===504){r=t.getView().getModel("i18n").getProperty("timeout");t.errorMsg(r)}else{r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r)}}})}else{t.MaterialGroup.open()}}},onLiveChangeMatGrp:function(e){var t=e.getParameters().value;var r=new Array;var a=new sap.ui.model.Filter([new sap.ui.model.Filter("materialGroupDesc",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("materialGroup",sap.ui.model.FilterOperator.Contains,t)]);r.push(a);var s=e.getSource().getBinding("items");s.filter(r)},valueHelpRequestReason:function(e){var t=this;if(!t.RejectReason){t.RejectReason=sap.ui.xmlfragment("incture.com.cherrywork.ConnectClientSalesOrderEnquiry.fragments.RejectReason",t);t.getView().addDependent(t.RejectReason);var r=this.getView().getModel("ZDKSH_CC_MASTER_ENQUIRIES_SRV");var a=[];var s="";if(sap.ushell){if(sap.ui.getCore().getConfiguration().getLanguage()==="th"){s="2"}else{s="E"}}else{s="E"}s=s.toUpperCase();var i=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("languageID",sap.ui.model.FilterOperator.EQ,s)],and:true});a.push(i);var o=new sap.m.BusyDialog;o.open();r.read("/RejectReasonLookUpSet",{async:false,filters:a,success:function(e,r){o.close();var a=new sap.ui.model.json.JSONModel({results:e.results});a.getData().results.unshift("");t.RejectReason.setModel(a,"RejectReasonModel");t.RejectReason.open()},error:function(e){o.close();var r="";if(e.statusCode===504){r=t.getView().getModel("i18n").getProperty("timeout");t.errorMsg(r)}else{r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r)}}})}else{t.RejectReason.open()}},handleRejectReason:function(e){var t=e.getParameters().selectedContexts[0].getObject();var r=this.getView().getModel("SaleHdrModelSet");r.getData().reason=t.rejReason;r.getData().reasonDesc=t.rejReasonDesc;r.refresh();e.getSource().getBinding("items").filter([])},onLiveChangeRejectReason:function(e){var t=e.getParameters().value;var r=new Array;var a=new sap.ui.model.Filter([new sap.ui.model.Filter("rejReason",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("rejReasonDesc",sap.ui.model.FilterOperator.Contains,t)]);r.push(a);var s=e.getSource().getBinding("items");s.filter(r)},valueHelpItemDelivery:function(e){var t=this;if(!t.ItemDelivery){t.ItemDelivery=sap.ui.xmlfragment("incture.com.cherrywork.ConnectClientSalesOrderEnquiry.fragments.ItemBlock",t);t.getView().addDependent(t.RejectReason);var r=this.getView().getModel("ZDKSH_CC_ITM_LOOKUP_SRV");var a=[];var s="";if(sap.ushell){if(sap.ui.getCore().getConfiguration().getLanguage()==="th"){s="2"}else{s="EN"}}else{s="EN"}s=s.toUpperCase();var i=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Language",sap.ui.model.FilterOperator.EQ,s)],and:true});a.push(i);var o=new sap.m.BusyDialog;o.open();r.read("/DeliveryBlckReasonSet",{async:false,filters:a,success:function(e,r){o.close();var a=new sap.ui.model.json.JSONModel({results:e.results});a.getData().results.unshift("");t.ItemDelivery.setModel(a,"ItemDeliveryModel");t.ItemDelivery.open()},error:function(e){o.close();var r="";if(e.statusCode===504){r=t.getView().getModel("i18n").getProperty("timeout");t.errorMsg(r)}else{r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r)}}})}else{t.ItemDelivery.open()}},handleItemDelivery:function(e){var t=e.getParameters().selectedContexts[0].getObject();var r=this.getView().getModel("SaleHdrModelSet");r.getData().itemDelivery=t.DeliveryBlock;r.getData().itemDeliveryDesc=t.Text;r.refresh();e.getSource().getBinding("items").filter([])},onLiveChangeItemDelivery:function(e){var t=e.getParameters().value;var r=new Array;var a=new sap.ui.model.Filter([new sap.ui.model.Filter("DeliveryBlock",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Text",sap.ui.model.FilterOperator.Contains,t)]);r.push(a);var s=e.getSource().getBinding("items");s.filter(r)},onLiveChangeMatGrp4:function(e){var t=e.getParameters().value;var r=new Array;var a=new sap.ui.model.Filter([new sap.ui.model.Filter("materialGroup4Desc",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("materialGroup4",sap.ui.model.FilterOperator.Contains,t)]);r.push(a);var s=e.getSource().getBinding("items");s.filter(r)},onCancelValueHelp:function(e){e.getSource().getBinding("items").filter([])},onConfirmChangeMatGrp4:function(e){var t=e.getParameters().selectedContexts[0].getObject();var r=this.getView().getModel("SaleHdrModelSet");r.getData().materialGroup4=t.materialGroup4;r.getData().materialGroup4Desc=t.materialGroup4Desc;r.refresh();e.getSource().getBinding("items").filter([])},mandatoryCheck:function(e){if(e.startDate&&e.endDate)return true;else{sap.m.MessageBox.information(this.getView().getModel("i18n").getProperty("enterFandT"));return false}},onSearch:function(){if(this.allAccess){var e=this.getView().getModel("ZDKSH_CC_MASTER_ENQUIRIES_SRV");var t=this.getView().getModel("SaleHdrModelSet").getData();if(this.mandatoryCheck(t)){var r=[],a=[],s=[],i=[];if(sap.ushell&&sap.ushell.Container){a=sap.ui.getCore().getConfiguration().getLanguage();if(a.toLowerCase()=="en")a="E";else a=2}else{a="E"}r.push(new sap.ui.model.Filter("languageID",sap.ui.model.FilterOperator.EQ,a));if(this.MaterialCodeDac&&this.MaterialCodeDac!="*"){r.push(new sap.ui.model.Filter("matNumEx",sap.ui.model.FilterOperator.EQ,this.MaterialCodeDac))}if(this.custCodeDataAccess&&this.custCodeDataAccess!="*"){r.push(new sap.ui.model.Filter("custNumEx",sap.ui.model.FilterOperator.EQ,this.custCodeDataAccess))}if(t.salesOrg)r.push(new sap.ui.model.Filter("salesOrg",sap.ui.model.FilterOperator.EQ,t.salesOrg));else r.push(new sap.ui.model.Filter("salesOrg",sap.ui.model.FilterOperator.EQ,this.salesOrgDataAccess));if(t.DistChan)r.push(new sap.ui.model.Filter("distChnl",sap.ui.model.FilterOperator.EQ,t.DistChan));else r.push(new sap.ui.model.Filter("distChnl",sap.ui.model.FilterOperator.EQ,this.distrChannelDataAccess));if(t.division)r.push(new sap.ui.model.Filter("division",sap.ui.model.FilterOperator.EQ,t.division));else r.push(new sap.ui.model.Filter("division",sap.ui.model.FilterOperator.EQ,this.divisionDataAccess));if(t.orderType)r.push(new sap.ui.model.Filter("salesDocType",sap.ui.model.FilterOperator.EQ,t.orderType));else r.push(new sap.ui.model.Filter("salesDocType",sap.ui.model.FilterOperator.EQ,this.orderTypeDataAccess));if(t.materialGroup)r.push(new sap.ui.model.Filter("materialGroup",sap.ui.model.FilterOperator.EQ,t.materialGroup));else r.push(new sap.ui.model.Filter("materialGroup",sap.ui.model.FilterOperator.EQ,this.materialGroupDataAccess));if(t.materialGroup4)r.push(new sap.ui.model.Filter("materialGroup4",sap.ui.model.FilterOperator.EQ,t.materialGroup4));else r.push(new sap.ui.model.Filter("materialGroup4",sap.ui.model.FilterOperator.EQ,this.materialGroup4DataAccess));if(t.deliveryBlock)r.push(new sap.ui.model.Filter("headerDeliveryBlock",sap.ui.model.FilterOperator.EQ,t.deliveryBlock));if(t.poType)r.push(new sap.ui.model.Filter("purchaseOrderType",sap.ui.model.FilterOperator.EQ,t.poType));if(t.vendorMaterial)r.push(new sap.ui.model.Filter("vendorMatNum",sap.ui.model.FilterOperator.EQ,t.vendorMaterial));if(t.material)r.push(new sap.ui.model.Filter("materialNumber",sap.ui.model.FilterOperator.EQ,t.material));if(t.customerNumber)r.push(new sap.ui.model.Filter("customerNumber",sap.ui.model.FilterOperator.EQ,t.customerNumber));if(t.DMSNumber)r.push(new sap.ui.model.Filter("DMSNumber",sap.ui.model.FilterOperator.EQ,t.DMSNumber));if(t.billingNumber){if(t.salesOrg===""||t.division===""||t.DistChan===""){sap.m.MessageBox.information(this.getView().getModel("i18n").getProperty("enterFilterSearch"));return false}else{r.push(new sap.ui.model.Filter("billingNumber",sap.ui.model.FilterOperator.EQ,t.billingNumber));r.push(new sap.ui.model.Filter("distChnl",sap.ui.model.FilterOperator.EQ,t.DistChan));r.push(new sap.ui.model.Filter("division",sap.ui.model.FilterOperator.EQ,t.division));r.push(new sap.ui.model.Filter("salesOrg",sap.ui.model.FilterOperator.EQ,t.salesOrg))}}if(t.PONo){if(t.materialGroup===""){sap.m.MessageBox.information(this.getView().getModel("i18n").getProperty("enterPOSearch"));return false}else{r.push(new sap.ui.model.Filter("PONo",sap.ui.model.FilterOperator.EQ,t.PONo))}}if(t.itemDelivery)r.push(new sap.ui.model.Filter("itemDeliveryBock",sap.ui.model.FilterOperator.EQ,t.itemDelivery));if(t.reason)r.push(new sap.ui.model.Filter("rejectReason",sap.ui.model.FilterOperator.EQ,t.reason));if(t.pendingOrder)r.push(new sap.ui.model.Filter("pendingOrder",sap.ui.model.FilterOperator.EQ,"X"));if(t.startDate){var o=String(t.startDate.getDate()).length==1?"0"+t.startDate.getDate():t.startDate.getDate();var l=t.startDate.getMonth()+1;l=String(l).length==1?"0"+l:l;var n=t.startDate.getFullYear();var u=n+"-"+l+"-"+o}if(t.endDate){var o=String(t.endDate.getDate()).length==1?"0"+t.endDate.getDate():t.endDate.getDate();var l=t.endDate.getMonth()+1;l=String(l).length==1?"0"+l:l;var n=t.endDate.getFullYear();var d=n+"-"+l+"-"+o}if(u&&d){var p=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("documentDate",sap.ui.model.FilterOperator.GE,u),new sap.ui.model.Filter("documentDate",sap.ui.model.FilterOperator.LE,d)],and:true})}else if(u){var p=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("documentDate",sap.ui.model.FilterOperator.GE,u)]})}if(t.salesOrderFrom&&t.salesOrderTo){var g=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("salesDocNumber",sap.ui.model.FilterOperator.GE,t.salesOrderFrom),new sap.ui.model.Filter("salesDocNumber",sap.ui.model.FilterOperator.LE,t.salesOrderTo)],and:true})}else if(t.salesOrderFrom){var g=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("salesDocNumber",sap.ui.model.FilterOperator.EQ,t.salesOrderFrom)]})}if(p)r.push(p);if(g)r.push(g);var m="/SOEnq_HeaderSet";var c=new sap.m.BusyDialog;c.open();var h=this;e.read(m,{urlParameters:{$expand:"HeaderToItemNav,HeaderToPartnersNav"},async:false,filters:r,success:function(e,t){h.getView().byId("searchField").setValue("");var r=new sap.ui.model.json.JSONModel;r.setProperty("/results1",e.results);if(e.results.length>0){r.getData().results=[];for(var a=0;a<e.results.length;a++){if(e.results[a].HeaderToItemNav.results&&e.results[a].HeaderToItemNav.results.length>0){for(var s=0;s<e.results[a].HeaderToItemNav.results.length;s++){r.getData().results.push({salesDocNumber:e.results[a].salesDocNumber,fdocumentDate:incture.com.MaterialEnquiry.model.formatter.dateDetailFormatter(e.results[a].documentDate),customerNumber:e.results[a].customerNumber,customerName:e.results[a].customerName,netAmount:e.results[a].HeaderToItemNav.results[s].netAmount,billingNumber:e.results[a].HeaderToItemNav.results[s].billingNumber,DMSNumber:e.results[a].HeaderToItemNav.results[s].DMSNumber,deliveryNumber:e.results[a].HeaderToItemNav.results[s].deliveryNum,salesTerritory:e.results[a].HeaderToItemNav.results[s].salesTerritory,salesTeam:e.results[a].HeaderToItemNav.results[s].salesTeam,index:a,materialNumber:e.results[a].HeaderToItemNav.results[s].materialNumber,materialDescription:e.results[a].HeaderToItemNav.results[s].materialDescription,purchaseOrderType:e.results[a].purchaseOrderType,purchaseOrderTypeDesc:e.results[a].purchaseOrderTypeDesc})}}}r.setSizeLimit(r.getData().results.length);h.getView().setModel(r,"oTableModel");r.refresh();var i=new sap.ui.model.json.JSONModel;i.setProperty("/results",e.results);sap.ui.getCore().setModel(i,"oGlobalModel");h.getView().byId("exportId").setEnabled(true);h.onUpdateFinshed()}else{var r=new sap.ui.model.json.JSONModel;h.getView().setModel(r,"oTableModel");r.setProperty("/results","");sap.m.MessageBox.error(h.getView().getModel("i18n").getProperty("dataNotFound"));h.getView().byId("exportId").setEnabled(false)}c.close()},error:function(e){c.close();var t="";var r=new sap.ui.model.json.JSONModel;h.getView().setModel(r,"oTableModel");r.setProperty("/results","");if(e.responseText.includes("abnormal terminated")){t=h.getView().getModel("i18n").getProperty("timeout");sap.m.MessageBox.error(t)}else if(e.statusCode==504){t=h.getView().getModel("i18n").getProperty("addMore");sap.m.MessageBox.error(t)}else{t=JSON.parse(e.responseText);t=t.error.message.value;sap.m.MessageBox.error(t)}}})}}else{sap.m.MessageToast.show(this.getView().getModel("i18n").getProperty("DataAccessControl"))}},onDateChange:function(e){var t=this.getView().getModel("SaleHdrModelSet").getData();if(e.getSource()._getPlaceholder()=="from"){if(t.endDate&&t.fromDate>t.endDate){sap.m.MessageToast.show(this.getView().getModel("i18n").getProperty("dateRange"));e.getSource().setValueState("Error");e.getSource().setValue("")}else{e.getSource().setValueState("None")}}else{if(!t.startDate){e.getSource().setValueState("Error");e.getSource().setValue("");sap.m.MessageToast.show(this.getView().getModel("i18n").getProperty("enterFromDate"))}else if(t.endDate&&t.startDate>t.endDate){e.getSource().setValueState("Error");e.getSource().setValue("");sap.m.MessageToast.show(this.getView().getModel("i18n").getProperty("dateRange"))}else{e.getSource().setValueState("None")}}},onLiveChange:function(e){var t;if(e.getParameters().newValue===undefined){t=e.getParameters().query}else{t=e.getParameters().newValue}var r=[];var a=new sap.ui.model.Filter([new sap.ui.model.Filter("salesDocNumber",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("fdocumentDate",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("customerNumber",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("customerName",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("netAmount",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("billingNumber",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("DMSNumber",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("deliveryNumber",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("salesTerritory",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("salesTeam",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("materialNumber",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("materialDescription",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("purchaseOrderType",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("purchaseOrderTypeDesc",sap.ui.model.FilterOperator.Contains,t)]);r.push(a);var s=this.getView().byId("idRet1").getBinding("items");s.filter(r);var i=this.getView().byId("idRet1").getItems();var o=s.aIndices;for(var l=0;l<i.length;l++){var n=this.getView().getModel("oTableModel").getData().results;if(n[o[l]].salesDocNumber&&n[o[l]].billingNumber&&n[o[l]].deliveryNumber)i[l].setHighlight("Success");else if(n[o[l]].salesDocNumber&&n[o[l]].billingNumber||n[o[l]].salesDocNumber&&n[o[l]].deliveryNumber)i[l].setHighlight("Warning");else i[l].setHighlight("Error")}},onExport:function(){var e=this.getView().getModel("oTableModel").getData().results1;var t=jQuery.extend([],e);var r=new sap.ui.model.json.JSONModel({results:t});var a=[];r.setSizeLimit(t.length);this.getView().setModel(r,"oExportModel");for(var s=0;s<t.length;s++){for(var o=0;o<t[s].HeaderToItemNav.results.length;o++){var l=t[s].HeaderToItemNav.results;a.push({salesDocNumber:t[s].salesDocNumber,fdocumentDate:incture.com.MaterialEnquiry.model.formatter.dateDetailFormatter(t[s].documentDate),cCustomer:incture.com.MaterialEnquiry.model.formatter.f4ValueBind(t[s].customerNumber,t[s].customerName),salesTerritory:l[o].salesTerritory,salesTeam:l[o].salesTeam,creditCheck:t[s].creditCheck,cOrderReason:incture.com.MaterialEnquiry.model.formatter.f4ValueBind(t[s].orderReason,t[s].orderReaText),customerPO:t[s].customerPO,cHdb:incture.com.MaterialEnquiry.model.formatter.f4ValueBind(t[s].headerDeliveryBlock,t[s].headerDlvBlockText),address:t[s].HeaderToPartnersNav.results[0].address,salesDocType:t[s].salesDocType,cDC:incture.com.MaterialEnquiry.model.formatter.f4ValueBind(t[s].distChnl,t[s].dcName),cPO:incture.com.MaterialEnquiry.model.formatter.f4ValueBind(t[s].purchaseOrderType,t[s].purchaseOrderTypeDesc),aroText:t[s].aroText,footNote:t[s].footNote,custThaiName:t[s].custThaiName,term:t[s].term,yourRef:t[s].yourRef,provinceName:t[s].provinceName,billingNumber:l[o].billingNumber,DMSNumber:l[o].DMSNumber,deliveryNumber:l[o].deliveryNum,deliveryDate:incture.com.MaterialEnquiry.model.formatter.dateDetailFormatter(l[o].deliveryDate),billingDate:incture.com.MaterialEnquiry.model.formatter.dateDetailFormatter(l[o].billingDate),itemNum:l[o].itemNumber,cMatNum:incture.com.MaterialEnquiry.model.formatter.f4ValueBind(l[o].materialNumber,l[o].materialDescription),materialGroup:l[o].materialGroup,materialGroup4:l[o].materialGroup4,materialGroup1:l[o].materialGroup1,vendorMatNum:l[o].vendorMatNum,cQty:incture.com.MaterialEnquiry.model.formatter.f4ValueBind(l[o].qtySold,l[o].salesUnit),cFOC:incture.com.MaterialEnquiry.model.formatter.f4ValueBind(l[o].focQty,l[o].salesUnit),listPrice:l[o].listPrice,specialPrice:l[o].specialPrice,netAmount:l[o].netAmount,batchNum:incture.com.MaterialEnquiry.model.formatter.expiryDateBind(l[o].batchNum,l[o].expiryDate),itemDeliveryBock:incture.com.MaterialEnquiry.model.formatter.f4ValueBind(l[o].itemDeliveryBock,l[o].itemDlvBlockText),rejectReason:incture.com.MaterialEnquiry.model.formatter.f4ValueBind(l[o].rejectReason,l[o].rejectDescription),use:l[o].use,storageLocation:incture.com.MaterialEnquiry.model.formatter.f4ValueBind(l[o].storageLocation,l[o].storageLocDesc),shippingPoint:l[o].shippingPoint,highLevel:l[o].highLevel,b2bStatus:l[o].b2bStatus.replace(/[@]/g," ")})}}var n=[{label:"Sales Order",property:"salesDocNumber"},{label:"Order Date",property:"fdocumentDate"},{label:"Customer",property:"cCustomer"},{label:"Net Amount",property:"netAmount"},{label:"Billing Number",property:"billingNumber"},{label:"Local Ref No",property:"DMSNumber"},{label:"Delivery Number",property:"deliveryNumber"},{label:"Sales Territory",property:"salesTerritory"},{label:"Sales Team",property:"salesTeam"},{label:"Billing Date",property:"billingDate"},{label:"Delivery Date",property:"deliveryDate"},{label:"Credit Check",property:"creditCheck"},{label:"Order reason",property:"cOrderReason"},{label:"Customer PO.",property:"customerPO"},{label:"Header Block",property:"cHdb"},{label:"Address",property:"address"},{label:"Order Type",property:"salesDocType"},{label:"Dist Channel",property:"cDC"},{label:"ARO Text",property:"aroText"},{label:"Foot Note",property:"footNote"},{label:"Customer (Local)",property:"custThaiName"},{label:"Payment Term",property:"term"},{label:"Your Reference",property:"yourRef"},{label:"Province",property:"provinceName"},{label:"Item No.",property:"itemNum"},{label:"Material",property:"cMatNum"},{label:"Material Group",property:"materialGroup"},{label:"Material Group4",property:"materialGroup4"},{label:"Material Group1",property:"materialGroup1"},{label:"Vendor Mat.",property:"vendorMatNum"},{label:"Sales Qty(Unit)",property:"cQty"},{label:"FOC Qty(Unit)",property:"cFOC"},{label:"List Price",property:"listPrice"},{label:"Special Price",property:"specialPrice"},{label:"Batch(Exp)",property:"batchNum"},{label:"Item block",property:"itemDeliveryBock"},{label:"Rejection reason",property:"rejectReason"},{label:"Usage",property:"use"},{label:"SLOC",property:"storageLocation"},{label:"Shipping Point",property:"shippingPoint"},{label:"High Level",property:"highLevel"},{label:"Status",property:"b2bStatus"},{label:"PO Type",property:"cPO"}];var n,u,d;n=n;u={workbook:{columns:n},dataSource:a,showProgress:false};d=new i(u);d.build().then(function(){}).finally(function(){d.destroy()})},onUpdateFinshed:function(){var e=this.getView().getModel("oTableModel").getData().results;var t=this.getView().byId("idRet1");var r=t.getItems();if(e&&e.length>0)for(var a=0;a<e.length;a++){if(e[a].salesDocNumber&&e[a].billingNumber&&e[a].deliveryNumber)r[a].setHighlight("Success");else if(e[a].salesDocNumber&&e[a].billingNumber||e[a].salesDocNumber&&e[a].deliveryNumber)r[a].setHighlight("Warning");else r[a].setHighlight("Error")}},onPressCollapse:function(){this.getView().getModel("baseModel").setProperty("/openVisiblity",true);this.getView().getModel("baseModel").setProperty("/CollapseVisiblity",false);this.getView().getModel("baseModel").setProperty("/SearchVisiblity",false)},onPressOpen:function(){this.getView().getModel("baseModel").setProperty("/openVisiblity",false);this.getView().getModel("baseModel").setProperty("/CollapseVisiblity",true);this.getView().getModel("baseModel").setProperty("/SearchVisiblity",true)},onAfterRendering:function(){}})});